<!DOCTYPE html> <meta charset=utf-8>
<script src=    "main.exe.js"></script>
<script src=    "open.exe.js"></script>
<script src=     "end.exe.js"></script>
<script src=    "rtk2.exe.js"></script>
<script src=    "rtk2.dat.js"></script>
<script src=    "rtk2.com.js"></script>
<script src=   "fmdrv.com.js"></script>
<script src=  "ending.dat.js"></script>
<script src= "grpdata.dat.js"></script>
<script src=  "kaoibm.dat.js"></script>
<script src= "montage.dat.js"></script>
<script src= "opening.dat.js"></script>
<script src="packdata.dat.js"></script>
<script src="scenario.dat.js"></script>
<script src=   "taiki.dat.js"></script>
<script src=  "decode.16p.js"></script>
<script src=    "pass.ori.js"></script>
<script src=    "play.bat.js"></script>
<style>input { min-width: 99px; text-align: center; } .text-right { text-align: right; }</style>
<title>KOEI 三國志 II 劇本修改器</title><center>
   <h1>KOEI 三國志 II 劇本修改器</h1><table>
<tr><td colspan=3>請使用 Chrome & Edge 瀏覽器<p></p>按下「F12」開啟檢視畫面<p></p>並切換到「主控台」進行閱覽<p></p></td></tr>
<tr><td>劇本編號</td><td><input type=number   id=scenario_val value=0 min=0 max=    6 onchange=scenario_val_onchange() pattern=[0-9]*></td><td><input type=button onclick =scenario_val_onclick() value=劇本訊息></td></tr>
<tr><td>勢力編號</td><td><input type=number   id=rulerAll_val value=0 min=0 max=   15 onchange=rulerAll_val_onchange() pattern=[0-9]*></td><td><input type=button onclick =rulerAll_val_onclick() value=勢力訊息></td></tr>
<tr><td>城市編號</td><td><input type=number   id=province_val value=0 min=0 max=   41 onchange=province_val_onchange() pattern=[0-9]*></td><td><input type=button onclick =province_val_onclick() value=城市訊息></td></tr>
<tr><td>人物編號</td><td><input type=number   id=officers_val value=0 min=0 max=  150 onchange=officers_val_onchange() pattern=[0-9]*></td><td><input type=button onclick =officers_val_onclick() value=人物訊息></td></tr>
<tr><td>人物頭像</td><td><input type=number   id=idx__kaodata value=0 min=0 max=  438 onchange=idx__kaodata_onchange() pattern=[0-9]*></td><td><canvas id=cvs__kaodata width=64 height=80></canvas> <span id=txt__kaodata></span></td></tr>
<tr><td>水滸頭像</td><td><input type=number   id=idx__kao_ibm value=0 min=0 max=  438 onchange=idx__kao_ibm_onchange() pattern=[0-9]*></td><td><canvas id=cvs__kao_ibm width=64 height=80></canvas> <span id=txt__kao_ibm></span></td></tr>
<tr><td>系統文字</td><td><input type=number   id=idx__msg_16p value=0 min=0 max=  438 onchange=idx__msg_16p_onchange() pattern=[0-9]*></td><td><canvas id=cvs__msg_16p width=16 height=14></canvas> <span id=txt__msg_16p></span></td></tr>
<tr><td>命名文字</td><td><input type=number   id=idx_name_16p value=0 min=0 max=  438 onchange=idx_name_16p_onchange() pattern=[0-9]*></td><td><canvas id=cvs_name_16p width=16 height=14></canvas> <span id=txt_name_16p></span></td></tr>
<tr><td>面板刷新</td><td><input type=checkbox id=refresh checked></td><td><input type=button onclick=location.reload() value=重新整理></td></tr>
<tr><td>劇本索引</td><td><input type=number   id=scenario_idx value=0 min=0 max=79386 onchange=scenario_idx_onchange() pattern=[0-9]*></td></tr>
<tr><td>劇本數值</td><td><input type=number   id=scenario_fix value=0 min=0 max=  256 onchange=scenario_fix_onchange() pattern=[0-9]*></td></tr>
</table><h2>下載專區</h2><div id=buttons style="width:500px"></div><p id=eula></p><p>Author: Regan Lu</p><p>Sponsor: Yuxio Tseng</p>
<script>
function	onchange_16p(canvas, get, idx, palette){
	var	cvs=document.getElementById(canvas);
	var	c16=cvs.id.includes('16p');
	var	ctx=cvs.getContext ( '2d');
		idx.value %= c16 ? idx.max: idx.max / 2;
	var	fst=cvs.width * cvs.height / 2 * idx.value;
	var	lst=cvs.width * cvs.height / 2 + fst;
	var	chr=c16 ? get[idx.value].value : get.slice(fst, lst);
for(	var	i  = 0; i < chr.length; i++){
		ctx.fillStyle = palette[chr[i]];
		ctx.fillRect(i % cvs.width, Math.floor(i / cvs.width) * (1 + !c16), 1, (1 + !c16));
}}		idx__msg_16p.max = Object.keys(get__msg_16p).length;
		idx_name_16p.max = Object.keys(get_name_16p).length;
		palette = ['#fff','#000'];
function	idx__msg_16p_onchange(){ onchange_16p('cvs__msg_16p', get__msg_16p, idx__msg_16p, palette); txt__msg_16p.innerHTML =     msg_16p_dic[idx__msg_16p.value] || ''; }
		idx__msg_16p_onchange();
function	idx_name_16p_onchange(){ onchange_16p('cvs_name_16p', get_name_16p, idx_name_16p, palette); txt_name_16p.innerHTML =    name_16p_dic[idx_name_16p.value] || ''; }
		idx_name_16p_onchange();
		palette = ['#000','#5f5','#f55','#ff5','#55f','#5ff','#f5f','#fff'];
function	idx__kaodata_onchange(){ onchange_16p('cvs__kaodata', get__kaodata, idx__kaodata, palette); txt__kaodata.innerHTML = kaodata_dat_dic[idx__kaodata.value] || ''; }
		idx__kaodata_onchange();
function	idx__kao_ibm_onchange(){ onchange_16p('cvs__kao_ibm', get__kao_ibm, idx__kao_ibm, palette); txt__kao_ibm.innerHTML = kaodata_dat_dic[idx__kao_ibm.value] || ''; }
		idx__kao_ibm_onchange();
</script>
<script>
//<!--	批次生成按鈕
var tmp = [
    "main.exe",
    "open.exe",
     "end.exe",
    "rtk2.exe",
    "rtk2.com",
   "fmdrv.com",
 "opening.dat",
  "ending.dat",
 "grpdata.dat",
 "hexdata.dat",
 "kaodata.dat",
  "kaoibm.dat",
 "montage.dat",
"packdata.dat",
"scenario.dat",
   "taiki.dat",
  "decode.16p",
     "msg.16p",
  "dicmsg.16p",
    "name.16p",
 "dicname.16p",
    "pass.ori",
    "play.bat",
];	buttons.innerHTML = ('' + tmp.map(x => '<input type=button onclick=download(' + x.split('.')[0] + '_' + x.split('.')[1] + 'comma\'' + x + '\') value=' + x + ' class=text-right>')).replace(/,/g,'').replace(/comma/g,',');
//-->
</script>
<script>
var	temp = '[scenario_val.value].'; var para = ['.劇本', temp + '勢力', temp + '城市', temp + '人物'],
	type = 'application/octet-stream';
function	scenario_val_onclick (){scenario_val.value%=scenario_val.max;console_clear();tData(para[0]);}
function	rulerAll_val_onclick (){rulerAll_val.value%=rulerAll_val.max;console_clear();tData(para[1]);}
function	province_val_onclick (){province_val.value%=province_val.max;console_clear();tData(para[2]);}
function	officers_val_onclick (){officers_val.value%=officers_val.max;console_clear();tData(para[3]);}
function	scenario_val_onchange(){scenario_val.value%=scenario_val.max;console_clear();tData(para[0]+'[scenario_val.value]');tData(para[1]);}
function	rulerAll_val_onchange(){rulerAll_val.value%=rulerAll_val.max;console_clear();tData(para[1]+'[rulerAll_val.value]');officers_val.value=rulerAll_val.value;tData(para[3]+'[officers_val.value]');}
function	province_val_onchange(){province_val.value%=province_val.max;console_clear();tData(para[2]+'[province_val.value]');}
function	officers_val_onchange(){officers_val.value%=officers_val.max;console_clear();tData(para[3]+'[officers_val.value]');}
function	scenario_idx_onchange(){scenario_idx.value%=scenario_idx.max;console.log('scenario_dat['+scenario_idx.value+'] = '+(scenario_fix.             value =scenario_dat[scenario_idx.value]));}
function	scenario_fix_onchange(){scenario_fix.value%=scenario_fix.max;console.log('scenario_dat['+scenario_idx.value+'] = '+(scenario_dat[scenario_idx.value]=scenario_fix.             value ));}
function	console_clear(){if(refresh.checked)console.clear();}
function	tData(x){eval("console." + (window.document.documentMode ? "log" : "table") + "(scenarioJson" + x + ")"); }
function	download(blob, download){
var	a		= window.document.createElement("a");
	a.href		= window.URL.createObjectURL(new Blob([typeof blob === "string" ? blob : new Uint8Array(blob)],{type}));
	a.download	= download;
	window.document.body.appendChild(a);
	a.click();
	window.document.body.removeChild(a);
}	eula.innerHTML	= "Copyright &copy; " + new Date().getFullYear() + ", All Rights Reserved.";
	console.table(scenarioJson);
</script>
